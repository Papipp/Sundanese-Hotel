{% extends "base.html" %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4 text-success">Dashboard Administrasi</h1>

        <!-- Manajemen Kamar-->
        <div class="card shadow mb-5">
            <div class="card-header bg-light">
                <h4 class="mb-0 text-success">Manajemen Kamar</h4>
            </div>
            <div class="card-body">
                
                <!-- Formulir Tambah/Edit Kamar -->
                <h5 class="mb-3">{% if edit_room %}Edit Kamar ID {{ edit_room.id }}{% else %}Tambah Kamar Baru{% endif %}</h5>
                <form method="POST" action="{{ url_for('admin_room_crud') }}">
                    <input type="hidden" name="id" value="{{ edit_room.id if edit_room else '' }}">
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <input type="text" class="form-control" name="name" placeholder="Nama/Tipe Kamar" value="{{ edit_room.name if edit_room else '' }}" required>
                        </div>
                        <div class="col-md-3">
                            <input type="number" class="form-control" name="price" placeholder="Harga/Malam (IDR)" value="{{ edit_room.price if edit_room else '' }}" min="100000" required>
                        </div>
                        <div class="col-md-3">
                            <input type="number" class="form-control" name="capacity" placeholder="Kapasitas Tamu" value="{{ edit_room.capacity if edit_room else '' }}" min="1" required>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-{% if edit_room %}info{% else %}success{% endif %} w-100">
                                {% if edit_room %}<i class="bi bi-save me-1"></i> Simpan Edit{% else %}<i class="bi bi-plus me-1"></i> Tambah Kamar{% endif %}
                            </button>
                        </div>
                    </div>
                    {% if edit_room %}
                        <div class="mb-3">
                            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary btn-sm">Batal Edit</a>
                        </div>
                    {% endif %}
                </form>

                <!-- Daftar Kamar (Read) -->
                <h5 class="mt-4">Daftar Kamar Tersedia</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-success">
                            <tr>
                                <th>ID</th>
                                <th>Tipe Kamar</th>
                                <th>Harga/Malam</th>
                                <th>Kapasitas</th>
                                <th class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for room in rooms %}
                            <tr>
                                <td>{{ room.id }}</td>
                                <td>{{ room.name }}</td>
                                <td>Rp{{ "{:,.0f}".format(room.price) }}</td>
                                <td>{{ room.capacity }}</td>
                                <td class="text-center">
                                    <a href="{{ url_for('admin_dashboard', edit_id=room.id) }}" class="btn btn-sm btn-info me-2 text-white"><i class="bi bi-pencil"></i> Edit</a>
                                    <a href="{{ url_for('admin_room_delete', room_id=room.id) }}" onclick="return confirm('Yakin hapus kamar {{ room.name }} dan SEMUA reservasinya?');" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Hapus</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Manajemen Reservasi (Read & Delete) -->
        <div class="card shadow">
            <div class="card-header bg-light">
                <h4 class="mb-0 text-success">Manajemen Reservasi</h4>
            </div>
            <div class="card-body">
                <h5>Daftar Semua Reservasi</h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-success">
                            <tr>
                                <th>ID Reservasi</th>
                                <th>Kamar</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Tamu/Kontak</th>
                                <th class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for res in reservations %}
                            <tr>
                                <td>{{ res.id }}</td>
                                <td>{{ res.room_name }} (ID:{{ res.room_id }})</td>
                                <td>{{ res.check_in }}</td>
                                <td>{{ res.check_out }}</td>
                                <td>{{ res.guest_name }} ({{ res.guests }} orang)<br><small class="text-muted">{{ res.email }}</small>
                                <br><small class="text-muted">{{ res.phone }}</small>
                              </td>
                                <td class="text-center">
                                    <a href="{{ url_for('admin_reservation_delete', res_id=res.id) }}" onclick="return confirm('Yakin batalkan reservasi ID {{ res.id }} atas nama {{ res.guest_name }}?');" class="btn btn-sm btn-danger"><i class="bi bi-x-circle"></i> Check-out</a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="text-center">Belum ada reservasi.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}